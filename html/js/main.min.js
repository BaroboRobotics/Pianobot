/*! Pianobot 01-03-2015 */

var chapter1=angular.module("chapter1",["ngRoute","ui.bootstrap","hljs","ngSanitize"]);chapter1.config(["$routeProvider",function(a){a.when("/",{controller:"pianobotController",templateUrl:"views/pianobot.html"}).otherwise({redirectTo:"/"})}]),chapter1.controller("pianobotController",["$scope","$timeout","$interval","robotFactory","util",function(a,b,c,d,e){function f(b){a.m.robot=b[0]}a.m={displayAllCode:!1,robot:null,running:!1},a.strike={},a.note={scientificPitch:{pitch:"a",octave:4},duration:500},a.toggle=function(){a.m.displayAllCode=!a.m.displayAllCode},a.run=function(){if(null!==a.m.robot){a.m.running=!0;var c=a.m.robot;c.buzzerFrequency(e.frequencyFromScientificPitch(a.note.scientificPitch)),b(function(){c.buzzerFrequency(0),a.m.running=!1},a.note.duration)}},a.stopAcquisition=function(){d.unregister()},a.strikeKey=function(b){a.strike=e.strikeFromEvent(b),e.startPlaying(b.target),null!==a.m.robot&&a.m.robot.buzzerFrequency(e.frequencyFromScientificPitch(a.strike.scientificPitch))},a.muteKey=function(b){a.strike instanceof e.Strike&&(e.stopPlaying(b.target),a.note=e.noteFromStrike(a.strike,b.timeStamp),a.strike={},null!==a.m.robot&&a.m.robot.buzzerFrequency(0))},a.swipeKey=function(b){a.strike instanceof e.Strike&&(e.stopPlaying(b.relatedTarget),a.note=e.noteFromStrike(a.strike,b.timeStamp),a.strikeKey(b))},a.leaveKey=function(b){e.isPianoKey(b.relatedTarget)||a.muteKey(b)},a.util=e,d.getRobots(f,1)}]).controller("lessonOneController",["$scope","$interval","robotFactory",function(){}]),chapter1.directive("contenteditable",["$sce",function(a){return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){function f(){var a=c.html();d.stripBr&&"<br>"==a&&(a=""),isNaN(a)?(a=parseFloat(a.replace(/[^0-9\.]+/g,"")),isNan(a)&&(a=0),e.$setViewValue(a),c.html(a)):e.$setViewValue(a)}e&&(e.$render=function(){c.html(a.getTrustedHtml(e.$viewValue||""))},c.on("blur change",function(){b.$evalAsync(f)}),f())}}}]),chapter1.factory("robotFactory",["$interval",function(a){function b(){console.log("attempting robot acquisition");var h=Linkbots.acquire(e);return h.robots.length===e?(f(h.robots),g=h.robots,a.cancel(d),void(d=null)):(h.robots.length>0&&c(h.robots),void(null===d&&(d=a(b,1e3))))}function c(a){if(a.length>0)for(var b=0;b<a.length;b++)Linkbots.relinquish(a[b])}var d=null,e=0,f=function(){},g=[];Linkbots.managerEvents.on("changed",function(){g.length>0&&(c(g),g=[]),e>0&&b()});var h={};return h.getRobots=function(a,d){return f=a,e=d,g.length==e?f(g):void(g.length>0?(c(g),g=[],b()):b())},h.unregister=function(){f=function(){},e=0,null!==d&&(a.cancel(intervalRef),intervalRef=null)},h}]).factory("util",function(){var a={};return a.frequencyFromScientificPitch=function(a){var b={c:0,cs:1,d:2,ds:3,e:4,f:5,fs:6,g:7,gs:8,a:9,as:10,b:11},c=12*a.octave-8+b[a.pitch];return 440*Math.pow(2,(c-49)/12)},a.oneDecimal=function(a){return Math.round(10*a)/10},a.Strike=function(a,b){this.scientificPitch=a,this.timeStamp=b},a.Note=function(a,b){this.scientificPitch=a,this.duration=b},a.scientificPitchFromEvent=function(a){return{pitch:a.target.dataset.pitch,octave:a.currentTarget.dataset.octave}},a.strikeFromEvent=function(b){return new a.Strike(a.scientificPitchFromEvent(b),b.timeStamp)},a.noteFromStrike=function(b,c){var d=new Date(c)-new Date(b.timeStamp);return new a.Note(b.scientificPitch,d)},a.startPlaying=function(a){$(a).addClassSvg("playing")},a.stopPlaying=function(a){$(a).removeClassSvg("playing")},a.isPianoKey=function(a){return $(a).hasClassSvg("piano-key")},a}),function(a){a.fn.addClassSvg=function(a){return"undefined"!=typeof this.attr("class")?this.attr("class",this.attr("class")+" "+a):this.attr("class",a)},a.fn.removeClassSvg=function(a){if("undefined"!=typeof this.attr("class")){var b=this.attr("class").split(" ");return this.attr("class",b.filter(function(b){return b!=a}).join(" "))}return this},a.fn.hasClassSvg=function(a){return"undefined"!=typeof this.attr("class")?this.attr("class").split(" ").some(function(b){return b==a}):!1}}(jQuery);
//# sourceMappingURL=main.min.js.map